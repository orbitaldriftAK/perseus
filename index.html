<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rooming List</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        input { width: 100%; border: none; text-align: center; }
        input:focus { outline: none; }
    </style>
</head>
<body>
    <h2>Rooming List</h2>
    <table>
        <tr>
            <th>Guest Name</th>
            <th>Check-in Date</th>
            <th>Check-out Date</th>
            <th>#A</th>
            <th>#C</th>
            <th>Room Type</th>
            <th>Reservation Status</th>
        </tr>
        <script>
            function createRow(index) {
                return `<tr>
                    <td><input type="text" id="guest${index}" onkeydown="checkF5(event, this)"></td>
                    <td><input type="date" id="checkin${index}"></td>
                    <td><input type="date" id="checkout${index}" onblur="validateDates(${index})"></td>
                    <td><input type="number" id="adults${index}" min="0" max="6" oninput="validateOccupancy(${index})" style="width:40px"></td>
                    <td><input type="number" id="children${index}" min="0" max="6" oninput="validateOccupancy(${index})" style="width:40px"></td>
                    <td><input type="text" id="roomType${index}" onkeydown="checkRoomType(event, ${index})"></td>
                    <td>RES</td>
                </tr>`;
            }
            document.write(createRow(1) + createRow(2) + createRow(3) + createRow(4) + createRow(5) + createRow(6) + createRow(7) + createRow(8) + createRow(9) + createRow(10));

            function validateDates(index) {
                let checkin = document.getElementById(`checkin${index}`).value;
                let checkout = document.getElementById(`checkout${index}`).value;
                if (checkin && checkout && checkin === checkout) {
                    alert("Departure must be different than arrival");
                    document.getElementById(`checkout${index}`).value = "";
                }
            }

            function validateOccupancy(index) {
                let adults = parseInt(document.getElementById(`adults${index}`).value) || 0;
                let children = parseInt(document.getElementById(`children${index}`).value) || 0;
                if (adults + children > 6) {
                    alert("Max occupancy exceeded");
                    document.getElementById(`adults${index}`).value = "";
                    document.getElementById(`children${index}`).value = "";
                }
            }

            function checkRoomType(event, index) {
                if (event.key === "Enter") {
                    let roomType = document.getElementById(`roomType${index}`).value.toUpperCase();
                    if (roomType !== "ST2Q" && roomType !== "ST1K") {
                        alert("Invalid room type");
                        document.getElementById(`roomType${index}`).value = "";
                    }
                }
            }

            function checkF5(event, input) {
                if (event.key === "F5") {
                    event.preventDefault();
                    if (input.value.trim() === "") {
                        alert("Guest Name must be entered before accessing the reservation screen.");
                        return;
                    }
                    saveTableData();
                    sessionStorage.setItem("guestName", input.value);
                    let rowIndex = input.parentElement.parentElement.rowIndex - 1;
                    sessionStorage.setItem("roomType", document.getElementById(`roomType${rowIndex + 1}`).value);
                    window.location.href = "reservation.html";
                }
            }

            function saveTableData() {
                let data = [];
                for (let i = 1; i <= 10; i++) {
                    data.push({
                        guest: document.getElementById(`guest${i}`).value,
                        checkin: document.getElementById(`checkin${i}`).value,
                        checkout: document.getElementById(`checkout${i}`).value,
                        adults: document.getElementById(`adults${i}`).value,
                        children: document.getElementById(`children${i}`).value,
                        roomType: document.getElementById(`roomType${i}`).value,
                    });
                }
                sessionStorage.setItem("savedData", JSON.stringify(data));
            }

            function loadTableData() {
                let savedData = JSON.parse(sessionStorage.getItem("savedData"));
                if (savedData) {
                    savedData.forEach((row, index) => {
                        document.getElementById(`guest${index+1}`).value = row.guest;
                        document.getElementById(`checkin${index+1}`).value = row.checkin;
                        document.getElementById(`checkout${index+1}`).value = row.checkout;
                        document.getElementById(`adults${index+1}`).value = row.adults;
                        document.getElementById(`children${index+1}`).value = row.children;
                        document.getElementById(`roomType${index+1}`).value = row.roomType;
                    });
                }
            }

            window.onload = loadTableData;
        </script>
    </table>

</body>
</html>
