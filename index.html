<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rooming List</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        input { width: 100%; border: none; text-align: center; }
        input:focus { outline: none; }
        /* Remove increment/decrement arrows from number inputs */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <h2>Rooming List</h2>
    <table>
        <tr>
            <th>Guest Name</th>
            <th>Check-in Date</th>
            <th>Check-out Date</th>
            <th>#A</th>
            <th>#C</th>
            <th>Room Type</th>
            <th>Reservation Status</th>
        </tr>
        <script>
            function createRow(index) {
                return `<tr>
                   <td><input type="text" id="guest${index}" onkeydown="checkF5(event, this); OnEnter(event, ${index}, 'checkin')"></td>
                   <td><input type="date" id="checkin${index}" onkeydown="OnEnter(event, ${index}, 'checkout')"></td>
                   <td><input type="date" id="checkout${index}" onblur="validateDates(${index})" onkeydown="OnEnter(event, ${index}, 'adults')"></td>
                   <td><input type="number" id="adults${index}" min="0" max="6" onkeydown="OnEnter(event, ${index}, 'children')" oninput="validateOccupancy(${index})" style="width:40px"></td>
                   <td><input type="number" id="children${index}" min="0" max="6" onkeydown="OnEnter(event, ${index}, 'roomType')" oninput="validateOccupancy(${index})" style="width:40px"></td>
                   <td><input type="text" id="roomType${index}" onkeydown="validateRoomType(event, ${index}); OnEnter(event, ${index}, 'guest')"></td>
                   <td>RES</td>
                </tr>`;
            }
            document.write(createRow(1) + createRow(2) + createRow(3) + createRow(4) + createRow(5) + createRow(6) + createRow(7) + createRow(8) + createRow(9) + createRow(10));

            function validateDates(index) {
                let checkin = document.getElementById(`checkin${index}`).value;
                let checkout = document.getElementById(`checkout${index}`).value;
                if (checkin && checkout) {
                    if (checkin === checkout) {
                        alert("Departure must be different than arrival");
                        document.getElementById(`checkout${index}`).value = "";
                    } else if (checkout < checkin) {
                        alert("Checkout can't be earlier than check-in");
                        document.getElementById(`checkout${index}`).value = "";
                    }
                }
            }

            function validateOccupancy(index) {
                let adults = parseInt(document.getElementById(`adults${index}`).value) || 0;
                let children = parseInt(document.getElementById(`children${index}`).value) || 0;
                if (adults + children > 6) {
                    alert("Max occupancy exceeded");
                    document.getElementById(`adults${index}`).value = "";
                    document.getElementById(`children${index}`).value = "";
                }
            }

            function validateRoomType(event, index) {
                if (event.key === "Enter") {
                    let roomTypeField = document.getElementById(`roomType${index}`);
                    let roomType = roomTypeField.value.toUpperCase();
                    if (roomType !== "ST2Q" && roomType !== "ST1K") {
                        alert("Invalid room type");
                        roomTypeField.value = "";
                    } else {
                        roomTypeField.value = roomType;
                    }
                }
            }

            function checkF5(event, input) {
                if (event.key === "F5") {
                    event.preventDefault();
                    let guestName = input.value.trim();
                    if (guestName !== "") {
                        let rowIndex = input.id.replace("guest", "");
                        let checkin = document.getElementById(`checkin${rowIndex}`).value;
                        let checkout = document.getElementById(`checkout${rowIndex}`).value;
                        let roomType = document.getElementById(`roomType${rowIndex}`).value;
                        let adultCount = document.getElementById(`adults${rowIndex}`).value;
                        let childCount = document.getElementById(`children${rowIndex}`).value;
                        
                        sessionStorage.setItem('guestName', guestName);
                        sessionStorage.setItem('checkin', checkin);
                        sessionStorage.setItem('checkout', checkout);
                        sessionStorage.setItem('roomType', roomType);
                        sessionStorage.setItem('adultCount', adultCount);
                        sessionStorage.setItem('childCount', childCount);

                        window.location.href = "reservation.html";
                    }
                }
            }

            function getTableData() {
                let data = [];
                for (let i = 1; i <= 10; i++) {
                    data.push({
                        guest: document.getElementById(`guest${i}`).value,
                        checkin: document.getElementById(`checkin${i}`).value,
                        checkout: document.getElementById(`checkout${i}`).value,
                        adults: document.getElementById(`adults${i}`).value,
                        children: document.getElementById(`children${i}`).value,
                        roomType: document.getElementById(`roomType${i}`).value,
                    });
                }
                return data;
            }

            function loadTableData() {
                let savedData = JSON.parse(localStorage.getItem("savedData"));
                if (savedData) {
                    savedData.forEach((row, index) => {
                        document.getElementById(`guest${index+1}`).value = row.guest;
                        document.getElementById(`checkin${index+1}`).value = row.checkin;
                        document.getElementById(`checkout${index+1}`).value = row.checkout;
                        document.getElementById(`adults${index+1}`).value = row.adults;
                        document.getElementById(`children${index+1}`).value = row.children;
                        document.getElementById(`roomType${index+1}`).value = row.roomType;
                    });
                }
            }

            function disableTab(event) {
                if (event.key === "Tab") {
                    event.preventDefault();
                }
            }

            window.onload = () => {
                loadTableData();
                document.addEventListener("keydown", disableTab);
            };

            function OnEnter(event, index, nextFieldId) {
                // Left/Right arrow key navigation within the same row
                if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
                    event.preventDefault();
                    const fieldOrder = ["guest", "checkin", "checkout", "adults", "children", "roomType"];
                    const currentId = event.target.id;
                    const match = currentId.match(/^([a-zA-Z]+)(\d+)$/);
                    if (match) {
                        const prefix = match[1];
                        const rowNum = match[2];
                        const pos = fieldOrder.indexOf(prefix);
                        if (event.key === "ArrowLeft" && pos > 0) {
                            const newFieldId = fieldOrder[pos - 1] + rowNum;
                            document.getElementById(newFieldId).focus();
                        } else if (event.key === "ArrowRight" && pos < fieldOrder.length - 1) {
                            const newFieldId = fieldOrder[pos + 1] + rowNum;
                            document.getElementById(newFieldId).focus();
                        }
                    }
                    return;
                }

                // Existing Enter key functionality
                if (event.key === "Enter") {
                    event.preventDefault();
                    if (nextFieldId === "roomType") {
                        document.getElementById(`roomType${index}`).focus();
                    } else if (nextFieldId === "guest" && index < 10) {
                        document.getElementById(`guest${index + 1}`).focus();
                    } else {
                        document.getElementById(`${nextFieldId}${index}`).focus();
                    }
                    // Auto-capitalize the first letter of each part of the Guest Name field
                    if (event.target.id.startsWith("guest")) {
                        let nameParts = event.target.value.split(" ");
                        for (let i = 0; i < nameParts.length; i++) {
                            if(nameParts[i].length > 0){
                                nameParts[i] = nameParts[i].charAt(0).toUpperCase() + nameParts[i].slice(1).toLowerCase();
                            }
                        }
                        event.target.value = nameParts.join(" ");
                    }
                }
            }
        </script>
    </table>
</body>
</html>
